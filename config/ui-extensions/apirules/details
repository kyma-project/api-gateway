header:
  - name: status
    widget: Badge
    highlights:
      positive:
        - 'OK'
      negative:
        - 'ERROR'
      critical:
        - 'SKIPPED'
    source: 'status.APIRuleStatus.code ? status.APIRuleStatus.code : "UNKNOWN"'
    description: status.APIRuleStatus.desc
  - name: host
    source: spec
    widget: APIRuleHost
body:
  - name: general
    source: spec
    widget: Panel
    visibility: $exists(spec.timeout)
    children:
    - source: timeout
      name: details.timeout
  - name: service
    source: spec.service
    widget: Panel
    children:
      - name: service.name
        source: name
        widget: ResourceLink
        resource:
          name: $root.spec.service.name
          namespace: $root.metadata.namespace
          kind: '"Service"'
      - name: service.port
        source: port
  - source: spec.rules
    widget: Table
    name: rules
    children:
      - source: $item.path
        name: rules.path
      - source: $item.methods
        name: rules.methods
        widget: Badge
    collapsible:
      - name: general
        source: $item
        widget: Panel
        visibility: $exists($item.timeout)
        children:
        - source: $item.timeout
          name: details.timeout
      - source: $item.accessStrategies
        widget: Table
        disablePadding: true
        name: accessStrategies
        children:
          - source: $item.handler
            name: accessStrategies.handlers
            widget: Badge
          - source: $item.config.required_scope
            name: accessStrategies.required_scope
            widget: JoinedArray
          - source: $item.config.jwks_urls
            name: accessStrategies.jwks_urls
            widget: JoinedArray
          - source: $item.config.trusted_issuers
            name: accessStrategies.trusted_issuers
            widget: JoinedArray
          - source: $item.config.introspection_url
            name: accessStrategies.introspection_url
            widget: Text
          - source: $item.config.introspection_request_headers
            name: accessStrategies.introspection_request_headers
            widget: Labels
          - source: $item.config.token_from
            name: accessStrategies.token_from
            widget: Labels
      - source: $item.mutators
        widget: Table
        disablePadding: true
        name: mutators
        visibility: $exists($item.mutators)
        children:
          - source: $item.handler
            name: mutators.handlers
            widget: Badge
          - source: $item.config
            name: mutators.config
      - name: service
        source: $item.service
        widget: Panel
        visibility: $exists($item.service)
        children:
          - name: service.name
            source: $item.service.name
            widget: ResourceLink
            resource:
              name: $item.service.name
              namespace: $root.metadata.namespace
              kind: '"Service"'
          - name: service.port
            source: $item.service.port
  - widget: ResourceList
    source: $virtualServices()
    name: virtualService
    disableCreate: true
